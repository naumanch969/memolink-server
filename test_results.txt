
> memolink-server@1.0.0 test
> jest src/features/challenge/challenge.service.test.ts --verbose

FAIL src/features/challenge/challenge.service.test.ts
  ChallengeService
    createChallenge
      ✓ should create a challenge and a schedule if within limit (6 ms)
      ✓ should throw error if active limit (3) is reached (16 ms)
    logChallengeDay
      ✕ should log progress and update stats (1 ms)
    updateChallengeStats (Logic Check)
      ✕ should calculate streak and completion % correctly (4 ms)
      ✕ should mark challenge as FAILED if missed threshold exceeded (4 ms)
      ✕ should mark challenge as COMPLETED if duration reached (2 ms)

  ● ChallengeService › logChallengeDay › should log progress and update stats

    TypeError: challenge_model_1.Challenge.findOne is not a function

      84 |
      85 |     async logChallengeDay(userId: string, params: CreateChallengeLogParams): Promise<IChallengeLog> {
    > 86 |         const challenge = await Challenge.findOne({
         |                                           ^
      87 |             _id: new Types.ObjectId(params.challengeId),
      88 |             userId: new Types.ObjectId(userId)
      89 |         });

      at ChallengeService.logChallengeDay (src/features/challenge/challenge.service.ts:86:43)
      at Object.<anonymous> (src/features/challenge/challenge.service.test.ts:95:51)

  ● ChallengeService › updateChallengeStats (Logic Check) › should calculate streak and completion % correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 3
    Received: undefined

      137 |             await challengeService['updateChallengeStats'](challengeId.toString());
      138 |
    > 139 |             expect(mockChallenge.stats.totalCompletions).toBe(3);
          |                                                          ^
      140 |             expect(mockChallenge.stats.missedDays).toBe(1);
      141 |             expect(mockChallenge.stats.currentStreak).toBe(1);
      142 |             expect(mockChallenge.stats.completionPercentage).toBe(43);

      at Object.<anonymous> (src/features/challenge/challenge.service.test.ts:139:58)

  ● ChallengeService › updateChallengeStats (Logic Check) › should mark challenge as FAILED if missed threshold exceeded

    expect(received).toBe(expected) // Object.is equality

    Expected: "failed"
    Received: "active"

      167 |             await challengeService['updateChallengeStats'](challengeId.toString());
      168 |
    > 169 |             expect(mockChallenge.status).toBe(ChallengeStatus.FAILED);
          |                                          ^
      170 |         });
      171 |
      172 |         it('should mark challenge as COMPLETED if duration reached', async () => {

      at Object.<anonymous> (src/features/challenge/challenge.service.test.ts:169:42)

  ● ChallengeService › updateChallengeStats (Logic Check) › should mark challenge as COMPLETED if duration reached

    expect(received).toBe(expected) // Object.is equality

    Expected: "completed"
    Received: "active"

      190 |             await challengeService['updateChallengeStats'](challengeId.toString());
      191 |
    > 192 |             expect(mockChallenge.status).toBe(ChallengeStatus.COMPLETED);
          |                                          ^
      193 |         });
      194 |     });
      195 | });

      at Object.<anonymous> (src/features/challenge/challenge.service.test.ts:192:42)

Test Suites: 1 failed, 1 total
Tests:       4 failed, 2 passed, 6 total
Snapshots:   0 total
Time:        4.75 s, estimated 6 s
Ran all test suites matching src/features/challenge/challenge.service.test.ts.
